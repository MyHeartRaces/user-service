# Сервис для работы с пользователями на NestJS

## Описание

Это проект на базе **NestJS**, представляющий собой сервис для работы с пользователями. Сервис предоставляет функционал для управления данными пользователей, включая установку флага "проблемы" и подсчёт количества пользователей с определённым флагом. В базе данных может храниться более 1 миллиона пользователей. Каждый пользователь имеет следующие поля:

- **Имя** (`firstName`)
- **Фамилия** (`lastName`)
- **Возраст** (`age`)
- **Пол** (`gender`)
- **Проблемы** (`issues`): логическое значение, показывающее наличие проблем у пользователя

## Стек технологий

- **Node.js**
- **NestJS**
- **TypeORM**
- **PostgreSQL**
- **TypeScript**

## Функционал

- Эндпоинт для сброса флага `проблемы` у всех пользователей и подсчета количества пользователей, у которых этот флаг был установлен в `true`.
- Сервис поддерживает работу с большими объёмами данных (более 1 миллиона записей).

## Установка и запуск проекта

### 1. Клонирование репозитория

Сначала клонируйте репозиторий проекта на вашу локальную машину:

```bash
git clone <URL вашего репозитория>
cd user-service
```

### 2. Установка зависимостей

Установите все необходимые зависимости, выполнив команду:

```bash
npm install
```

### 3. Настройка базы данных

Создайте базу данных PostgreSQL для проекта, например, с именем `testdb`.

Настройте файл окружения `.env` в корне проекта с вашими параметрами подключения к базе данных:

```
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=testdb
```

### 4. Заполнение базы данных тестовыми данными

Для заполнения базы данных тестовыми пользователями (1,000,000 записей) выполните команду:

```bash
npm run seed
```

Эта команда запустит скрипт, который создаст и добавит пользователей в базу данных.

### 5. Запуск сервиса

Для запуска сервиса в режиме разработки используйте команду:

```bash
npm run start:dev
```

Сервис будет доступен по адресу `http://localhost:3000`.

### 6. Использование API

#### Эндпоинт для сброса флага "проблемы"

- **URL**: `POST /users/reset-issues`
- **Описание**: Сбрасывает флаг `issues` у всех пользователей на `false` и возвращает количество пользователей, у которых флаг был установлен в `true`.
- **Пример запроса**:

  ```bash
  curl -X POST http://localhost:3000/users/reset-issues
  ```

- **Пример ответа**:

  ```json
  {
    "message": "Issues flag reset for all users",
    "count": 500746
  }
  ```

## Структура проекта

- `src/` - исходный код проекта
    - `app.module.ts` - основной модуль приложения
    - `user/` - модуль для работы с пользователями
        - `user.entity.ts` - описание сущности пользователя
        - `user.service.ts` - бизнес-логика для работы с пользователями
        - `user.controller.ts` - контроллер для обработки запросов, связанных с пользователями
- `src/seeds/seed.ts` - скрипт для наполнения базы данных тестовыми пользователями
